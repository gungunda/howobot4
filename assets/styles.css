@layer reset, tokens, base, layout, components, utilities;

/* ---------------------------------------
   RESET
--------------------------------------- */
@layer reset {
  *, *::before, *::after { box-sizing: border-box; }
  html, body { height: 100%; }
  body { margin: 0; }
  img, svg, video, canvas { display: block; max-width: 100%; height: auto; }
  button, input, textarea, select { font: inherit; }
}

/* ---------------------------------------
   TOKENS (цвета, шрифты, отступы)
--------------------------------------- */
@layer tokens {
  :root{
    /* Цвета */
    --bg: #ffffff;
    --fg: #1f2328;
    --muted: #6a737d;
    --primary: #0b5fff;
    --border: #e2e8f0;
    --card: #f8fafc;

    /* Типографика */
    --font-ui: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;

    /* Шаги отступов (rem) */
    --s-0: 0rem;
    --s-1: 0.25rem;   /* 4px */
    --s-2: 0.5rem;    /* 8px */
    --s-3: 0.75rem;   /* 12px */
    --s-4: 1rem;      /* 16px */
    --s-5: 1.5rem;    /* 24px */
    --s-6: 2rem;      /* 32px */
    --s-7: 3rem;      /* 48px */

    /* Радиусы */
    --r-1: 0.375rem;  /* 6px */
    --r-2: 0.5rem;    /* 8px */
    --r-3: 0.75rem;   /* 12px */

    /* Тени — лёгкие для мобилок */
    --shadow-1: 0 1px 2px rgba(0,0,0,.06);
    --shadow-2: 0 10px 30px rgba(0,0,0,.25);

    /* Масштаб текста (примерная шкала) */
    --fs-xs: 0.8125rem; /* 13px */
    --fs-sm: 0.875rem;  /* 14px */
    --fs-md: 1rem;      /* 16px */
    --fs-lg: clamp(1.125rem, 1rem + 1vw, 1.25rem);  /* ~18–20px */
    --fs-xl: clamp(1.25rem, 1rem + 2vw, 1.5rem);    /* ~20–24px */
  }

  @media (prefers-color-scheme: dark) {
    :root{
      --bg: #0b0e12;
      --fg: #e8edf2;
      --muted: #9aa5b1;
      --border: #2a3542;
      --card: #11161d;
      --primary: #3b82f6;
    }
  }
}

/* ---------------------------------------
   БАЗА
--------------------------------------- */
@layer base {
  html { font-size: 100%; }
  body {
    min-height: 100dvh;
    font-family: var(--font-ui);
    background: var(--bg);
    color: var(--fg);
    line-height: 1.5;
    padding-inline: clamp(12px, 4vw, 24px);
  }

  /* Доступный фокус */
  :where(a, button, [role="button"], input, select, textarea):focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }

  /* Утилиты типографики */
  .muted { color: var(--muted); }
  .small { font-size: var(--fs-sm); }
}

/* ---------------------------------------
   LAYOUT (адаптив без ломки DOM)
--------------------------------------- */
@layer layout {
  .topbar{
    display:flex; align-items:center; justify-content:space-between;
    gap: var(--s-3);
    padding: var(--s-3) var(--s-4);
    border-bottom: 1px solid var(--border);
    background: var(--bg);
    position: sticky; top: 0; z-index: 10;
  }
  .topbar-title{ font-weight:600; font-size: var(--fs-lg); }
  .topbar-nav{ display:flex; gap: var(--s-2); flex-wrap: wrap; }

  /* Центральный контент — ограничиваем ширину и центрируем; делаем его container */
  .main{
    padding-block: var(--s-4);
    max-width: 42rem;            /* ≈ 672px */
    margin-inline: auto;
    width: 100%;
    container-type: inline-size; /* для @container-правил ниже */
  }

  .section{ margin-block: var(--s-4); }
  .section-title{ margin: 0 0 var(--s-3); font-size: var(--fs-lg); }

  .stats-row{
    display:flex; gap: var(--s-3); flex-wrap:wrap; margin-block: var(--s-2);
  }
  .stat-box{
    padding: var(--s-1) var(--s-2);
    border:1px solid var(--border);
    border-radius: var(--r-2);
    background: #fff;
    box-shadow: var(--shadow-1);
    flex: 1 1 calc(50% - var(--s-3)); /* 2 в ряд при ширине, иначе падают в столбец */
    min-width: 12rem;
  }

  .view{ display:none; }
  .view.is-active{ display:block; }

  .row{ display:flex; gap: var(--s-2); align-items:center; flex-wrap:wrap; }

  .task-list{ display:flex; flex-direction:column; gap: var(--s-2); }

  /* Сетка недели — дефолт через viewport (fallback) */
  .week-grid{ display:grid; grid-template-columns: repeat(1, 1fr); gap: var(--s-3); }
  @media (min-width: 720px){ .week-grid{ grid-template-columns: repeat(2, 1fr); } }
  @media (min-width: 1024px){ .week-grid{ grid-template-columns: repeat(3, 1fr); } }

  .calendar-header{ display:flex; align-items:center; gap: var(--s-2); margin-block: var(--s-2); }

  .calendar-grid{
    display:grid; grid-template-columns:repeat(7,1fr); gap: var(--s-1);
    border-top:1px solid var(--border); padding-top: var(--s-2);
  }

  .footer{
    padding: var(--s-3) var(--s-4);
    border-top:1px solid var(--border);
    max-width: 42rem;
    margin-inline: auto;
    width: 100%;
  }

  /* ---------- Контентные брейки через container queries ---------- */
  @supports (container-type: inline-size) {
    /* week-grid 1→2→3 колонок в зависимости от ширины .main, а не всего вьюпорта */
    @container (min-width: 40rem) {
      .week-grid{ grid-template-columns: repeat(2, 1fr); }
    }
    @container (min-width: 64rem) {
      .week-grid{ grid-template-columns: repeat(3, 1fr); }
    }

    /* статистика: 1→2→3 карточки в ряд по мере расширения контейнера */
    @container (min-width: 30rem) {
      .stat-box{ flex: 1 1 calc(33.333% - var(--s-3)); }
    }
    @container (min-width: 48rem) {
      .stat-box{ flex: 1 1 calc(25% - var(--s-3)); min-width: 10rem; }
    }
  }

  /* Узкие экраны (safety tweaks) */
  @media (max-width: 360px) {
    .topbar { padding-inline: var(--s-3); }
    .calendar-grid { gap: var(--s-1); }
    .calendar-grid .cell { padding: 0.5rem; }
  }
}

/* ---------------------------------------
   COMPONENTS
--------------------------------------- */
@layer components {
  .btn{
    padding: 0.375rem 0.625rem;
    border:1px solid var(--border);
    background:#fff;
    border-radius: var(--r-2);
    cursor:pointer;
    font-size: var(--fs-md);
    line-height: 1.2;
    min-height: 2.75rem; /* ≥ ~44px */
  }
  .btn:disabled{ opacity:.6; cursor: not-allowed; }
  .btn-danger{ color:#fff; background:#ef4444; border-color:#ef4444; }
  .btn.primary { background: #2d7ef7; color: #fff; border: none; }
  .btn.ghost { background: transparent; border: 1px solid #bbb; }

  .input{
    padding: 0.375rem 0.5rem;
    border:1px solid var(--border);
    border-radius: var(--r-1);
    min-height: 2.75rem;
    font-size: var(--fs-md);
    inline-size: 100%;
  }

  /* БЫЛО: фикс 180px. Становится адаптивным в контейнерах. */
  .range{
    inline-size: min(100%, 20rem);  /* ≤ 320px, иначе 100% */
    block-size: auto;
  }

  .card{
    border:1px solid var(--border);
    background: var(--card);
    padding: var(--s-3);
    border-radius: var(--r-3);
    margin-block: var(--s-2);
    box-shadow: var(--shadow-1);
  }

  /* === Calendar cells === */
  .calendar-grid .cell{
    display:flex; align-items:center; justify-content:center;
    padding: 0.625rem;
    border:1px solid var(--border); border-radius: var(--r-3);
    background:#fff; cursor:pointer; user-select:none;
    min-height: 2.625rem;
  }
  .calendar-grid .cell.is-head{
    background:transparent; border:none; font-weight:600; color:var(--muted); cursor:default;
  }
  .calendar-grid .cell.is-outside-month{ opacity:.5; }
  .calendar-grid .cell.is-today{ outline:2px solid var(--primary); }
  .calendar-grid .cell.is-selected{ background:var(--card); border-color:var(--primary); }
  .calendar-grid .cell:hover{ box-shadow:0 0 0 2px rgba(0,0,0,.04); }

  /* ===== Modal overlay ===== */
  .modal { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 1000; }
  .modal[open] { display: flex; }
  .modal-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,0.45); }
  .modal-card {
    position: relative;
    background: #fff;
    width: min(30rem, 92vw);
    max-height: 88dvh;
    overflow: auto;
    border-radius: var(--r-3);
    box-shadow: var(--shadow-2);
    padding: var(--s-4);
  }
  .modal-close {
    position: absolute; top: var(--s-2); right: var(--s-2);
    border: none; background: transparent; font-size: 1.25rem; cursor: pointer;
  }
  .modal-card h3 { margin: 0 0 var(--s-3) 0; font-size: var(--fs-lg); }
  .form-row { display: flex; gap: var(--s-2); align-items: center; margin: var(--s-2) 0; }
  .form-row label { min-width: 6rem; }
  .form-row .unload-grid label { min-width: 0; }
  .form-row input[type="text"],
  .form-row input[type="number"] {
    flex: 1;
    padding: 0.375rem 0.5rem;
    border: 1px solid #ccc;
    border-radius: var(--r-1);
    min-height: 2.75rem;
    font-size: var(--fs-md);
    inline-size: 100%;
  }
  .form-actions { display: flex; gap: var(--s-2); justify-content: flex-end; margin-top: var(--s-3); }

  /* Dashboard add button */
  .dashboard-add { margin-top: var(--s-3); }
}

/* ---------------------------------------
   UTILITIES
--------------------------------------- */
@layer utilities {
  .topbar-title{ font-weight:600; }
  .section-title{ font-weight:600; }

  /* Предпочтение сниженной анимации (на будущее) */
  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
  }
}


